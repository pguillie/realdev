#!/bin/sh

# For mac or linux users, you can download and install by
# curl -s https://static.real.dev/cli/install | sh

DONE="‚ú® Done! Now type 'real' and get started!"

case "$(uname -s)" in
    Darwin*)    NAME=real-macos.gz;;
    Linux*)     NAME=real-linux.gz;;
    CYGWIN*)    NAME=real-linux.gz;;
    MINGW*)     NAME=real-linux.gz;;
    *)          NAME=real-linux.gz
esac

download_install() {
  local download_link=$1
  echo "üòä Hi, I am Real.Dev installer."
  echo "üëª I'm going to install the 'real' CLI."

  echo "‚è≥ Hang on, awesomeness is being downloaded"
  curl -o /tmp/real.gz $download_link
  gunzip -f /tmp/real.gz
  chmod +x /tmp/real

  echo "ü§ì It will be installed to ~/bin."
  mv /tmp/real ~/bin/real 2>/dev/null
  local e=$?
  if [ ! "${e}" -eq "0" ]; then
    echo "‚å®Ô∏è Please type your root passport to proceed:"
    sudo mv /tmp/real ~/bin/real
    echo "$DONE"
  else
    echo "$DONE"
  fi
}

determine_download_link() {
  local latest_commit="$(curl -s --ssl https://static.real.dev/cli/VERSION | tail -1 | cut -d' ' -f2)"
  local version="commit-${latest_commit}"
  local download_link=https://static.real.dev/cli/"$version"/"$NAME"
  echo $download_link
}

link="$(determine_download_link $NAME)"
download_install $link
